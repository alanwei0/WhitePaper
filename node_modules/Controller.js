var util = require('util');
var EventEmitter = require('events').EventEmitter;

function Controller(){
    this.eventManager;
    this.mongodb;
}

util.inherits(Controller,EventEmitter);

Controller.prototype.init = function(mongodb , eventManager){
    var self = this;
    this.eventManager= eventManager;
    this.mongodb = mongodb;

    eventManager.on(eventManager.load_room_id_req , function(data,socket){
        console.log('controller get load_room_id_req');
        var time = new Date();
        time = time.getTime();
        var roomId = (time-13141516)*13;
        roomId = roomId.toString();
        eventManager.emit(eventManager.load_room_id_res , roomId , socket);
    });

    eventManager.on(eventManager.create_room_req , function(data , socket){
        console.log('controller get create_room_req');
        self.mongodb.createRoom(data , function(res_data){
            eventManager.emit(eventManager.create_room_res , res_data , socket);
        });
    });

    eventManager.on(eventManager.join_room_req , function(data , socket){
        console.log('controller get join_room_req');
        self.mongodb.joinRoom(data , function(res_data){
            var success = res_data[0];
            console.log(success);
            eventManager.emit(eventManager.join_room_res , res_data ,socket);
        }); 
    });

    eventManager.on(eventManager.save_canvas , function(data , socket){
        console.log('controller get save_canvas');
        self.mongodb.saveCanvas(data , function(res_data){});
    });
};

module.exports = Controller;